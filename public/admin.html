<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Upload (Cloudinary FINAL)</title>
  <style>
    body{background:#000;color:#fff;font-family:Arial;padding:40px}
    h1{color:#e50914}
    form{max-width:520px;background:#141414;padding:25px;border-radius:8px}
    input,select,button{width:100%;padding:12px;margin:10px 0;background:#222;border:1px solid #333;color:#fff}
    button{background:#e50914;border:none;font-size:16px;cursor:pointer}
    .status{margin-top:10px;color:#00ff88}
  </style>
</head>
<body>

<h1>Admin Upload</h1>

<form id="f">
  <input id="title" placeholder="Movie title" required>

  <select id="language">
    <option>Telugu</option>
    <option>Hindi</option>
    <option>English</option>
  </select>

  <input id="year" placeholder="Year">

  <select id="category">
    <option>Action</option>
    <option>Drama</option>
    <option>Comedy</option>
  </select>

  <input id="poster" type="file" accept="image/*" required>
  <input id="video" type="file" accept="video/mp4" required>

  <button type="submit">Upload</button>
  <div class="status" id="s"></div>
</form>

<script>
/* ===== CLOUDINARY CONFIG ===== */
const CLOUD_NAME = "dchekxdof";
const UPLOAD_PRESET = "ibomma_clone";

const f = document.getElementById("f");
const s = document.getElementById("s");

async function uploadImage(file){
  const fd = new FormData();
  fd.append("file", file);
  fd.append("upload_preset", UPLOAD_PRESET);

  const r = await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
    { method:"POST", body: fd }
  );
  return r.json();
}

async function uploadVideo(file){
  const fd = new FormData();
  fd.append("file", file);
  fd.append("upload_preset", UPLOAD_PRESET);

  const r = await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`,
    { method:"POST", body: fd }
  );
  return r.json();
}

f.onsubmit = async (e)=>{
  e.preventDefault();
  s.innerText = "Uploading... please wait";

  try{
    const posterRes = await uploadImage(poster.files[0]);
    const videoRes  = await uploadVideo(video.files[0]);

    await fetch("/videos/save",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        title: title.value,
        language: language.value,
        year: year.value,
        category: category.value,
        posterUrl: posterRes.secure_url,
        videoUrl: videoRes.secure_url
      })
    });

    s.innerText = "✅ Upload SUCCESS";
    f.reset();

  }catch(err){
    console.error(err);
    s.innerText = "❌ Upload FAILED";
  }
};
</script>

</body>
</html>
