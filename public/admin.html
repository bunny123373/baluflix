<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Upload (Cloudinary)</title>
  <style>
    body{
      background:#000;
      color:#fff;
      font-family:Arial;
      padding:40px
    }
    h1{color:#e50914}
    form{
      max-width:520px;
      background:#141414;
      padding:25px;
      border-radius:8px
    }
    input,select,button{
      width:100%;
      padding:12px;
      margin:10px 0;
      background:#222;
      border:1px solid #333;
      color:#fff
    }
    button{
      background:#e50914;
      border:none;
      cursor:pointer;
      font-size:16px
    }
    .status{
      margin-top:10px;
      color:#00ff88
    }
  </style>
</head>
<body>

<h1>Admin Upload</h1>

<form id="uploadForm">
  <input id="title" placeholder="Movie title" required>

  <select id="language">
    <option>Telugu</option>
    <option>Hindi</option>
    <option>English</option>
  </select>

  <input id="year" placeholder="Release Year">

  <select id="category">
    <option>Action</option>
    <option>Drama</option>
    <option>Comedy</option>
  </select>

  <input id="poster" type="file" accept="image/*" required>
  <input id="video" type="file" accept="video/*" required>

  <button type="submit">Upload</button>
  <div class="status" id="status"></div>
</form>

<script>
/* ================================
   CLOUDINARY FINAL CONFIG
   ================================ */
const CLOUD_NAME = "dchekxdof";     // ❌ change cheyyakudadhu
const UPLOAD_PRESET = "ibomma_clone"; // ✅ nuvvu pettina name

const form = document.getElementById("uploadForm");
const statusBox = document.getElementById("status");

async function uploadToCloudinary(file, folder){
  const fd = new FormData();
  fd.append("file", file);
  fd.append("upload_preset", UPLOAD_PRESET);
  fd.append("folder", folder);

  const res = await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`,
    { method: "POST", body: fd }
  );
  return res.json();
}

form.onsubmit = async (e)=>{
  e.preventDefault();
  statusBox.innerText = "Uploading... please wait";

  try{
    const posterRes = await uploadToCloudinary(
      poster.files[0],
      "ibomma_clone/posters"
    );

    const videoRes = await uploadToCloudinary(
      video.files[0],
      "ibomma_clone/videos"
    );

    await fetch("/videos/save",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        title: title.value,
        language: language.value,
        year: year.value,
        category: category.value,
        posterUrl: posterRes.secure_url,
        videoUrl: videoRes.secure_url
      })
    });

    statusBox.innerText = "✅ Upload SUCCESS";
    form.reset();

  }catch(err){
    statusBox.innerText = "❌ Upload FAILED";
  }
};
</script>

</body>
</html>
